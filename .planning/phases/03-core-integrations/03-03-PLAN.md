---
phase: 03-core-integrations
plan: 03
type: execute
wave: 3
depends_on: [03-01, 03-02]
files_modified: []
autonomous: false
requirements: [CU-01, MAIL-01, MAIL-02, CAL-01, DRIVE-02]
user_setup: []

must_haves:
  truths:
    - "Python 3.11+ and uvx are available on the production server"
    - "workspace-mcp is pre-cached on the server (no cold-start download)"
    - "@hauptsache.net/clickup-mcp is pre-cached on the server"
    - "Google OAuth consent is complete and tokens are stored by workspace-mcp"
    - "User can ask about ClickUp tasks and get real data back"
    - "User can ask about Gmail inbox and get real email summaries"
    - "User can ask about calendar and get real schedule"
    - "User can search Google Drive documents and get real content"
    - "Multi-source queries return merged results from relevant integrations"
    - "Unavailable integration returns clear error message, not a crash"
  artifacts: []
  key_links:
    - from: "Claude conversation"
      to: "google-workspace MCP server"
      via: "MCP stdio transport spawned by Claude CLI"
      pattern: "workspace-mcp"
    - from: "Claude conversation"
      to: "clickup MCP server"
      via: "MCP stdio transport spawned by Claude CLI"
      pattern: "clickup-mcp"
---

<objective>
Complete server setup (Python/uvx, MCP server pre-caching, Google OAuth consent) and verify all four integrations work end-to-end via natural language queries.

Purpose: The code from Plans 01 and 02 is in place, but the integrations won't work until: (1) Python/uvx is installed on the server, (2) MCP servers are pre-cached, (3) Google OAuth consent is completed, (4) API keys are configured in .env. This plan handles all setup and validates everything works.
Output: Fully operational integrations verified by human testing.
</objective>

<execution_context>
@C:/Users/dimsh/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dimsh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-integrations/03-RESEARCH.md
@.planning/phases/03-core-integrations/03-01-SUMMARY.md
@.planning/phases/03-core-integrations/03-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Server setup and Google OAuth consent</name>
  <action>
  The following steps require human action because they involve server access, credential creation, and browser-based OAuth consent.
  </action>
  <how-to-verify>
  Complete the following setup steps:

  **Step 1: ClickUp API Key**
  1. Go to ClickUp Settings -> Apps -> Generate API Token
  2. Copy the personal API token (starts with `pk_`)
  3. Find your Team ID from any ClickUp URL: `app.clickup.com/{team_id}/...`
  4. Add to `.env` on the server:
     ```
     CLICKUP_API_KEY=pk_xxxxx
     CLICKUP_TEAM_ID=xxxxx
     ```

  **Step 2: Google Cloud OAuth Credentials**
  1. Go to Google Cloud Console -> APIs & Services -> Library
  2. Enable: Gmail API, Google Calendar API, Google Drive API
  3. Go to Credentials -> Create Credentials -> OAuth 2.0 Client ID
  4. Application type: Desktop app (or Web app with localhost redirect)
  5. Copy Client ID and Client Secret
  6. Add to `.env` on the server:
     ```
     GOOGLE_OAUTH_CLIENT_ID=xxxxx.apps.googleusercontent.com
     GOOGLE_OAUTH_CLIENT_SECRET=GOCSPX-xxxxx
     ```

  **Step 3: Python and uvx on Server**
  1. SSH to server: `ssh clawdbot@91.98.194.94`
  2. Check Python: `python3 --version` (need 3.11+)
  3. If not installed: `sudo apt install python3.11 python3.11-venv` (or appropriate package manager)
  4. Install uv: `curl -LsSf https://astral.sh/uv/install.sh | sh`
  5. Verify: `uvx --version`

  **Step 4: Pre-cache MCP Servers**
  1. On the server, run:
     ```bash
     uvx workspace-mcp --help
     npx -y @hauptsache.net/clickup-mcp@latest --help
     ```
  2. This downloads and caches the packages for faster cold starts.

  **Step 5: Google OAuth Consent**
  1. On the server, run workspace-mcp in auth mode:
     ```bash
     GOOGLE_OAUTH_CLIENT_ID=xxxxx GOOGLE_OAUTH_CLIENT_SECRET=xxxxx uvx workspace-mcp --auth-only
     ```
     (Check workspace-mcp docs for exact auth command -- may be `uvx workspace-mcp` with `--setup` or similar flag)
  2. It will output a URL. Open that URL in your browser.
  3. Sign in with your Google account and authorize access to Gmail, Calendar, and Drive.
  4. The tokens will be stored in `~/.google-workspace-mcp/` on the server.

  **Step 6: Deploy and Restart**
  1. Deploy the latest code to the server
  2. Fix NODE_ENV: `ssh clawdbot@91.98.194.94 "sed -i 's/NODE_ENV=development/NODE_ENV=production/' ~/personal-assistant/.env"`
  3. Restart: `pm2 restart astra-bot --update-env`
  4. Check logs: `pm2 logs astra-bot --lines 30`
  5. Verify no startup errors, confirm "ClickUp deadline monitor started" in logs (no calendar monitor — deferred)
  </how-to-verify>
  <resume-signal>Type "setup complete" when all steps are done, or describe any issues encountered</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end integration verification</name>
  <action>All four integrations (ClickUp, Gmail, Google Calendar, Google Drive) have been configured and deployed via MCP in Plan 01. ClickUp deadline monitor (direct REST API, no LLM) active from Plan 02. This task verifies real end-to-end data flows.</action>
  <what-built>All four integrations (ClickUp, Gmail, Google Calendar, Google Drive) configured and running via MCP. ClickUp deadline monitor active (REST API only, no scheduled LLM calls).</what-built>
  <how-to-verify>
  Send these messages to Astra via Telegram and verify responses:

  **Test 1: ClickUp (CU-01)**
  Send: "What tasks are overdue?" or "Show me tasks in [your project name]"
  Expected: Real task data from ClickUp (task names, statuses, assignees). NOT a generic "I don't have access" response.

  **Test 2: Gmail (MAIL-01, MAIL-02)**
  Send: "Show me my priority emails" or "What's in my inbox?"
  Expected: Real email summaries with sender, subject, and priority classification. NOT fabricated data.

  **Test 3: Google Calendar (CAL-01)**
  Send: "What's on my calendar today?" or "What meetings do I have this week?"
  Expected: Real calendar events with times, titles, and attendees. NOT generic responses.

  **Test 4: Google Drive (DRIVE-02)**
  Send: "Find the GDD for [project name]" or "What documents do I have about [topic]?"
  Expected: Real document names/links from Drive. If asked about content, Claude should read and summarize.

  **Test 5: Multi-source query**
  Send: "Show me everything going on this week" or "What do I need to focus on today?"
  Expected: Merged response with data from ClickUp tasks + Calendar events + Gmail inbox, organized by source.

  **Test 6: Error handling**
  If any integration fails: Does Astra give a clear error message naming the specific service?

  **Test 7: ClickUp proactive alerts**
  If you have tasks with deadlines within 24h: Check if deadline notifications arrive automatically (via direct REST API, no LLM involved).
  Note: Calendar reminders are deferred — will be implemented via trigger-based patterns after discussion.
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe which tests failed and what happened</resume-signal>
</task>

</tasks>

<verification>
All 7 test scenarios pass:
1. ClickUp tasks returned from real data
2. Gmail emails summarized with priorities
3. Calendar events displayed with real schedule
4. Drive documents found and content readable
5. Multi-source queries merge data from multiple services
6. Unavailable services produce clear error messages
7. ClickUp proactive alerts dispatch for approaching deadlines (direct REST API, no LLM)
</verification>

<success_criteria>
- All four integrations return real data from respective services
- Multi-source queries work (parallel tool calls, merged response)
- Error handling is graceful (named service, no crash)
- ClickUp deadline monitor dispatches notifications (REST API only, no LLM)
- User confirms all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-integrations/03-03-SUMMARY.md`
</output>
